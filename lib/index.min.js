"use strict";function t(t){return fetch(t).then((t=>t.text()))}function e(e){t(e.url).then((n=>{n=n.replace(/<head[^>]*>[\s\S]*?<\/head>/i,(t=>t.replace(/<head/i,"<picocontainer-app-head").replace(/<\/head>/i,"</picocontainer-app-head>"))).replace(/<body[^>]*>[\s\S]*?<\/body>/i,(t=>t.replace(/<body/i,"<picocontainer-app-body").replace(/<\/body>/i,"</picocontainer-app-body>")));const s=document.createElement("div");s.innerHTML=n,console.log("html:",s),o(s,e);const c=s.querySelector("picocontainer-app-head");e.source.links.size?function(e,o,n){const s=Array.from(e.source.links.entries()),c=[];for(const[o]of s)c.push(t(e.url+o));Promise.all(c).then((t=>{for(let e=0;e<t.length;e++){const n=t[e],c=document.createElement("style");c.textContent=n,o.appendChild(c),s[e][1].code=n}e.onLoad(n)})).catch((t=>{console.error("加载css出错",t)}))}(e,c,s):e.onLoad(s),e.source.scripts.size?function(e,o){const n=Array.from(e.source.scripts.entries()),s=[];for(const[o,c]of n)s.push(c.code?Promise.resolve(c.code):t(e.url+o));Promise.all(s).then((t=>{for(let e=0;e<t.length;e++){const o=t[e];n[e][1].code=o}e.onLoad(o)})).catch((t=>{console.error("加载js出错",t)}))}(e,s):e.onLoad(s)})).catch((t=>{console.error("加载html出错",t)}))}function o(t,e){const n=Array.from(t.children);n.length&&n.forEach((t=>{o(t,e)}));for(const o of n)if(o instanceof HTMLLinkElement){const n=o.getAttribute("href");"stylesheet"===o.getAttribute("rel")&&n&&e.source.links.set(n,{code:""}),t.removeChild(o)}else if(o instanceof HTMLScriptElement){const n=o.getAttribute("src");if(n)e.source.scripts.set(n,{code:"",isExternal:!0});else if(o.textContent){const t=Math.random().toString(36).substr(2,15);e.source.scripts.set(t,{code:o.textContent,isExternal:!1})}t.removeChild(o)}}Object.defineProperty(exports,"__esModule",{value:!0});class n{constructor({name:t,url:o,container:n}){this.name="",this.url="",this.container=null,this.loadCount=0,this.status="created",this.source={links:new Map,scripts:new Map,html:""},this.container=null!=n?n:null,this.name=t,this.url=o,this.status="loading",e(this)}onLoad(t){this.loadCount=this.loadCount?this.loadCount+1:1,2===this.loadCount&&"unmount"!==this.status&&(this.source.html=t,this.mount())}mount(){var t;const e=this.source.html.cloneNode(!0),o=document.createDocumentFragment();Array.from(e.childNodes).forEach((t=>{o.appendChild(t)})),null===(t=this.container)||void 0===t||t.appendChild(o),this.source.scripts.forEach((t=>{(0,eval)(t.code)})),this.status="mounted"}unmount(){}}const s=new Map;var c;!function(t){t.NAME="name",t.URL="url"}(c||(c={}));class r extends HTMLElement{constructor(){super(),this.appName="",this.appUrl=""}static get observedAttributes(){return["name","url"]}connectedCallback(){console.log("picocontainer-app is connected");const t=new n({name:this.appName,url:this.appUrl,container:this});s.set(this.appName,t)}disconnectedCallback(){console.log("picocontainer-app has disconnected");s.get(this.appName).unmount(this.hasAttribute("destory"))}attributeChangedCallback(t,e,o){console.log(`attribute ${t}: ${o}-${e}`),this[t===c.NAME?"appName":"appUrl"]!==o&&(t!==c.URL||this.appUrl?t!==c.NAME||this.appName||(this.appName=o):this.appUrl=o)}}const a={start(){window.customElements.get("picocontainer-app")||window.customElements.define("picocontainer-app",r)}};exports.default=a;
//# sourceMappingURL=index.min.js.map
