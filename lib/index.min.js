"use strict";function t(t){return fetch(t).then((t=>t.text()))}Object.defineProperty(exports,"__esModule",{value:!0});let e=null;function o(t,o){var s,r;const c=`picocontainer-app[name=${o}]`;if(e||(e=document.createElement("style"),document.body.appendChild(e),e.sheet.disabled=!0),t.textContent)e.textContent=t.textContent,t.textContent=n(Array.from(null!==(r=null===(s=e.sheet)||void 0===s?void 0:s.cssRules)&&void 0!==r?r:[]),c),e.textContent="";else{const e=new MutationObserver((()=>{var o,s;e.disconnect(),t.textContent=n(Array.from(null!==(s=null===(o=t.sheet)||void 0===o?void 0:o.cssRules)&&void 0!==s?s:[]),c)}));e.observe(t,{childList:!0})}}function n(t,e){let o="";for(const n of t)"CSSStyleRule"===n.constructor.name?o+=r(n,e):"CSSMediaRule"===n.constructor.name?o+=s(n,e,"media"):"CSSSupportsRule"===n.constructor.name?o+=s(n,e,"supports"):o+=n.cssText;return o}function s(t,e,o){const s=n(Array.from(t.cssRules),e);return`@${o} ${t.conditionText} {${s}}`}function r(t,e){const{selectorText:o,cssText:n}=t;if(/^((html[\s>~,]+body)|(html|body|:root))$/.test(o))return n.replace(/^((html[\s>~,]+body)|(html|body|:root))/,e);if("*"===o)return n.replace("*",`${e} *`);const s=/(^|\s+)((html[\s>~]+body)|(html|body|:root))(?=[\s>~]+|$)/;return n.replace(/^[\s\S]+{/,(t=>t.replace(/(^|,)([^,]+)/g,((t,o,n)=>s.test(n)?t.replace(s,e):`${o} ${e} ${n.replace(/^\s*/,"")}`))))}function c(e){t(e.url).then((n=>{n=n.replace(/<head[^>]*>[\s\S]*?<\/head>/i,(t=>t.replace(/<head/i,"<picocontainer-app-head").replace(/<\/head>/i,"</picocontainer-app-head>"))).replace(/<body[^>]*>[\s\S]*?<\/body>/i,(t=>t.replace(/<body/i,"<picocontainer-app-body").replace(/<\/body>/i,"</picocontainer-app-body>")));const s=document.createElement("div");s.innerHTML=n,console.log("html:",s),a(s,e);const r=s.querySelector("picocontainer-app-head");e.source.links.size?function(e,n,s){const r=Array.from(e.source.links.entries()),c=[];for(const[o]of r)c.push(t(e.url+o));Promise.all(c).then((t=>{for(let s=0;s<t.length;s++){const c=t[s],a=document.createElement("style");a.textContent=c,o(a,e.name),n.appendChild(a),r[s][1].code=c}e.onLoad(s)})).catch((t=>{console.error("加载css出错",t)}))}(e,r,s):e.onLoad(s),e.source.scripts.size?function(e,o){const n=Array.from(e.source.scripts.entries()),s=[];for(const[o,r]of n)s.push(r.code?Promise.resolve(r.code):t(e.url+o));Promise.all(s).then((t=>{for(let e=0;e<t.length;e++){const o=t[e];n[e][1].code=o}e.onLoad(o)})).catch((t=>{console.error("加载js出错",t)}))}(e,s):e.onLoad(s)})).catch((t=>{console.error("加载html出错",t)}))}function a(t,e){const n=Array.from(t.children);n.length&&n.forEach((t=>{a(t,e)}));for(const s of n)if(s instanceof HTMLLinkElement){const o=s.getAttribute("href");"stylesheet"===s.getAttribute("rel")&&o&&e.source.links.set(o,{code:""}),t.removeChild(s)}else if(s instanceof HTMLScriptElement){const o=s.getAttribute("src");if(o)e.source.scripts.set(o,{code:"",isExternal:!0});else if(s.textContent){const t=Math.random().toString(36).substr(2,15);e.source.scripts.set(t,{code:s.textContent,isExternal:!1})}t.removeChild(s)}else s instanceof HTMLStyleElement&&o(s,e.name)}class i{constructor({name:t,url:e,container:o}){this.name="",this.url="",this.container=null,this.loadCount=0,this.status="created",this.source={links:new Map,scripts:new Map,html:""},this.container=null!=o?o:null,this.name=t,this.url=e,this.status="loading",c(this)}onLoad(t){this.loadCount=this.loadCount?this.loadCount+1:1,2===this.loadCount&&"unmount"!==this.status&&(this.source.html=t,this.mount())}mount(){var t;const e=this.source.html.cloneNode(!0),o=document.createDocumentFragment();Array.from(e.childNodes).forEach((t=>{o.appendChild(t)})),null===(t=this.container)||void 0===t||t.appendChild(o),this.source.scripts.forEach((t=>{(0,eval)(t.code)})),this.status="mounted"}unmount(){}}const l=new Map;var u;!function(t){t.NAME="name",t.URL="url"}(u||(u={}));class p extends HTMLElement{constructor(){super(),this.appName="",this.appUrl=""}static get observedAttributes(){return["name","url"]}connectedCallback(){console.log("picocontainer-app is connected");const t=new i({name:this.appName,url:this.appUrl,container:this});l.set(this.appName,t)}disconnectedCallback(){console.log("picocontainer-app has disconnected");l.get(this.appName).unmount(this.hasAttribute("destory"))}attributeChangedCallback(t,e,o){console.log(`attribute ${t}: ${o}-${e}`),this[t===u.NAME?"appName":"appUrl"]!==o&&(t!==u.URL||this.appUrl?t!==u.NAME||this.appName||(this.appName=o):this.appUrl=o)}}const d={start(){window.customElements.get("picocontainer-app")||window.customElements.define("picocontainer-app",p)}};exports.default=d;
//# sourceMappingURL=index.min.js.map
