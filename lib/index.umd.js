!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).picocontaineroApp={})}(this,(function(e){"use strict";function t(e){return fetch(e).then((e=>e.text()))}let o=null;function n(e,t){var n,r;const c=`picocontainer-app[name=${t}]`;if(o||(o=document.createElement("style"),document.body.appendChild(o),o.sheet.disabled=!0),e.textContent)o.textContent=e.textContent,e.textContent=s(Array.from(null!==(r=null===(n=o.sheet)||void 0===n?void 0:n.cssRules)&&void 0!==r?r:[]),c),o.textContent="";else{const t=new MutationObserver((()=>{var o,n;t.disconnect(),e.textContent=s(Array.from(null!==(n=null===(o=e.sheet)||void 0===o?void 0:o.cssRules)&&void 0!==n?n:[]),c)}));t.observe(e,{childList:!0})}}function s(e,t){let o="";for(const n of e)"CSSStyleRule"===n.constructor.name?o+=c(n,t):"CSSMediaRule"===n.constructor.name?o+=r(n,t,"media"):"CSSSupportsRule"===n.constructor.name?o+=r(n,t,"supports"):o+=n.cssText;return o}function r(e,t,o){const n=s(Array.from(e.cssRules),t);return`@${o} ${e.conditionText} {${n}}`}function c(e,t){const{selectorText:o,cssText:n}=e;if(/^((html[\s>~,]+body)|(html|body|:root))$/.test(o))return n.replace(/^((html[\s>~,]+body)|(html|body|:root))/,t);if("*"===o)return n.replace("*",`${t} *`);const s=/(^|\s+)((html[\s>~]+body)|(html|body|:root))(?=[\s>~]+|$)/;return n.replace(/^[\s\S]+{/,(e=>e.replace(/(^|,)([^,]+)/g,((e,o,n)=>s.test(n)?e.replace(s,t):`${o} ${t} ${n.replace(/^\s*/,"")}`))))}function i(e){t(e.url).then((o=>{o=o.replace(/<head[^>]*>[\s\S]*?<\/head>/i,(e=>e.replace(/<head/i,"<picocontainer-app-head").replace(/<\/head>/i,"</picocontainer-app-head>"))).replace(/<body[^>]*>[\s\S]*?<\/body>/i,(e=>e.replace(/<body/i,"<picocontainer-app-body").replace(/<\/body>/i,"</picocontainer-app-body>")));const s=document.createElement("div");s.innerHTML=o,console.log("html:",s),a(s,e);const r=s.querySelector("picocontainer-app-head");e.source.links.size?function(e,o,s){const r=Array.from(e.source.links.entries()),c=[];for(const[o]of r)c.push(t(e.url+o));Promise.all(c).then((t=>{for(let s=0;s<t.length;s++){const c=t[s],i=document.createElement("style");i.textContent=c,n(i,e.name),o.appendChild(i),r[s][1].code=c}e.onLoad(s)})).catch((e=>{console.error("加载css出错",e)}))}(e,r,s):e.onLoad(s),e.source.scripts.size?function(e,o){const n=Array.from(e.source.scripts.entries()),s=[];for(const[o,r]of n)s.push(r.code?Promise.resolve(r.code):t(e.url+o));Promise.all(s).then((t=>{for(let e=0;e<t.length;e++){const o=t[e];n[e][1].code=o}e.onLoad(o)})).catch((e=>{console.error("加载js出错",e)}))}(e,s):e.onLoad(s)})).catch((e=>{console.error("加载html出错",e)}))}function a(e,t){const o=Array.from(e.children);o.length&&o.forEach((e=>{a(e,t)}));for(const s of o)if(s instanceof HTMLLinkElement){const o=s.getAttribute("href");"stylesheet"===s.getAttribute("rel")&&o&&t.source.links.set(o,{code:""}),e.removeChild(s)}else if(s instanceof HTMLScriptElement){const o=s.getAttribute("src");if(o)t.source.scripts.set(o,{code:"",isExternal:!0});else if(s.textContent){const e=Math.random().toString(36).substr(2,15);t.source.scripts.set(e,{code:s.textContent,isExternal:!1})}e.removeChild(s)}else s instanceof HTMLStyleElement&&n(s,t.name)}class l{constructor({name:e,url:t,container:o}){this.name="",this.url="",this.container=null,this.loadCount=0,this.status="created",this.source={links:new Map,scripts:new Map,html:""},this.container=null!=o?o:null,this.name=e,this.url=t,this.status="loading",i(this)}onLoad(e){this.loadCount=this.loadCount?this.loadCount+1:1,2===this.loadCount&&"unmount"!==this.status&&(this.source.html=e,this.mount())}mount(){var e;const t=this.source.html.cloneNode(!0),o=document.createDocumentFragment();Array.from(t.childNodes).forEach((e=>{o.appendChild(e)})),null===(e=this.container)||void 0===e||e.appendChild(o),this.source.scripts.forEach((e=>{(0,eval)(e.code)})),this.status="mounted"}unmount(){}}const u=new Map;var p;!function(e){e.NAME="name",e.URL="url"}(p||(p={}));class d extends HTMLElement{constructor(){super(),this.appName="",this.appUrl=""}static get observedAttributes(){return["name","url"]}connectedCallback(){console.log("picocontainer-app is connected");const e=new l({name:this.appName,url:this.appUrl,container:this});u.set(this.appName,e)}disconnectedCallback(){console.log("picocontainer-app has disconnected");u.get(this.appName).unmount(this.hasAttribute("destory"))}attributeChangedCallback(e,t,o){console.log(`attribute ${e}: ${o}-${t}`),this[e===p.NAME?"appName":"appUrl"]!==o&&(e!==p.URL||this.appUrl?e!==p.NAME||this.appName||(this.appName=o):this.appUrl=o)}}const h={start(){window.customElements.get("picocontainer-app")||window.customElements.define("picocontainer-app",d)}};e.default=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
