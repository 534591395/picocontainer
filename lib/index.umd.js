!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).picocontaineroApp={})}(this,(function(e){"use strict";function t(e){return fetch(e).then((e=>e.text()))}function o(e){t(e.url).then((o=>{o=o.replace(/<head[^>]*>[\s\S]*?<\/head>/i,(e=>e.replace(/<head/i,"<picocontainer-app-head").replace(/<\/head>/i,"</picocontainer-app-head>"))).replace(/<body[^>]*>[\s\S]*?<\/body>/i,(e=>e.replace(/<body/i,"<picocontainer-app-body").replace(/<\/body>/i,"</picocontainer-app-body>")));const s=document.createElement("div");s.innerHTML=o,console.log("html:",s),n(s,e);const c=s.querySelector("picocontainer-app-head");e.source.links.size?function(e,o,n){const s=Array.from(e.source.links.entries()),c=[];for(const[o]of s)c.push(t(e.url+o));Promise.all(c).then((t=>{for(let e=0;e<t.length;e++){const n=t[e],c=document.createElement("style");c.textContent=n,o.appendChild(c),s[e][1].code=n}e.onLoad(n)})).catch((e=>{console.error("加载css出错",e)}))}(e,c,s):e.onLoad(s),e.source.scripts.size?function(e,o){const n=Array.from(e.source.scripts.entries()),s=[];for(const[o,c]of n)s.push(c.code?Promise.resolve(c.code):t(e.url+o));Promise.all(s).then((t=>{for(let e=0;e<t.length;e++){const o=t[e];n[e][1].code=o}e.onLoad(o)})).catch((e=>{console.error("加载js出错",e)}))}(e,s):e.onLoad(s)})).catch((e=>{console.error("加载html出错",e)}))}function n(e,t){const o=Array.from(e.children);o.length&&o.forEach((e=>{n(e,t)}));for(const n of o)if(n instanceof HTMLLinkElement){const o=n.getAttribute("href");"stylesheet"===n.getAttribute("rel")&&o&&t.source.links.set(o,{code:""}),e.removeChild(n)}else if(n instanceof HTMLScriptElement){const o=n.getAttribute("src");if(o)t.source.scripts.set(o,{code:"",isExternal:!0});else if(n.textContent){const e=Math.random().toString(36).substr(2,15);t.source.scripts.set(e,{code:n.textContent,isExternal:!1})}e.removeChild(n)}}class s{constructor({name:e,url:t,container:n}){this.name="",this.url="",this.container=null,this.loadCount=0,this.status="created",this.source={links:new Map,scripts:new Map,html:""},this.container=null!=n?n:null,this.name=e,this.url=t,this.status="loading",o(this)}onLoad(e){this.loadCount=this.loadCount?this.loadCount+1:1,2===this.loadCount&&"unmount"!==this.status&&(this.source.html=e,this.mount())}mount(){var e;const t=this.source.html.cloneNode(!0),o=document.createDocumentFragment();Array.from(t.childNodes).forEach((e=>{o.appendChild(e)})),null===(e=this.container)||void 0===e||e.appendChild(o),this.source.scripts.forEach((e=>{(0,eval)(e.code)})),this.status="mounted"}unmount(){}}const c=new Map;var i;!function(e){e.NAME="name",e.URL="url"}(i||(i={}));class r extends HTMLElement{constructor(){super(),this.appName="",this.appUrl=""}static get observedAttributes(){return["name","url"]}connectedCallback(){console.log("picocontainer-app is connected");const e=new s({name:this.appName,url:this.appUrl,container:this});c.set(this.appName,e)}disconnectedCallback(){console.log("picocontainer-app has disconnected");c.get(this.appName).unmount(this.hasAttribute("destory"))}attributeChangedCallback(e,t,o){console.log(`attribute ${e}: ${o}-${t}`),this[e===i.NAME?"appName":"appUrl"]!==o&&(e!==i.URL||this.appUrl?e!==i.NAME||this.appName||(this.appName=o):this.appUrl=o)}}const a={start(){window.customElements.get("picocontainer-app")||window.customElements.define("picocontainer-app",r)}};e.default=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
